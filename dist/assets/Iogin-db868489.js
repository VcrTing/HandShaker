import{_ as L}from"./OBtnSave.vue_vue_type_script_setup_true_lang-1dd96f5b.js";import{d as v,g as f,a8 as I,h as p,o as b,c as y,a as o,b as l,w as d,i as c,B as _,C as g,X as T,ag as u,q as B,aK as C,aL as R,m as k,L as x,u as S,n as U,k as w,ac as V,p as j}from"./index-c02dffd3.js";import{L as K}from"./IOGO_MENU-d6706ad0.js";import{_ as O}from"./OInputI.vue_vue_type_script_setup_true_lang-8917e070.js";import{c as A}from"./verify-18da9a0d.js";import{b as h}from"./route-block-83d24a4e.js";import"./OIoadDot.vue_vue_type_script_setup_true_lang-3d4cbf47.js";import"./OIoadCir.vue_vue_type_script_setup_true_lang-f96beb73.js";import"./MBtn.vue_vue_type_script_setup_true_lang-686a7428.js";import"./Oi.vue_vue_type_script_setup_true_lang-c317e4c1.js";import"./DocumentTextIcon-949aeb5b.js";import"./XMarkIcon-99b1c700.js";const E={class:"py"},N=o("div",{class:"py"},null,-1),P=v({__name:"ioginForm",props:{form:{},aii:{}},emits:["submit"],setup(t){const s=t,r=["name","pass"],e=f(I(s.form));return p(()=>s.aii.sign,()=>{r.map(a=>{if(u(e,a,s.form[a],s.aii)){s.aii.can=!1;return}}),s.aii.can=!0}),p(()=>s.form.name,a=>u(e,"name",a,s.aii)),p(()=>s.form.pass,a=>u(e,"pass",a,s.aii,()=>!A(a,200))),(a,i)=>{const n=O;return b(),y("div",null,[o("div",E,[l(n,{icon:"email",err:c(e).name},{default:d(()=>[_(o("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=m=>a.form.name=m),placeholder:"登錄郵箱"},null,512),[[g,a.form.name]])]),_:1},8,["err"]),N,l(n,{icon:"lock",err:c(e).pass},{default:d(()=>[_(o("input",{onKeydown:i[1]||(i[1]=T(m=>a.$emit("submit"),["enter"])),type:"password","onUpdate:modelValue":i[2]||(i[2]=m=>a.form.pass=m),placeholder:"登錄密碼"},null,544),[[g,a.form.pass]])]),_:1},8,["err"])])])}}}),q={"":"網絡連結錯誤！！！","Invalid identifier or password":"帳戶或密碼錯誤！！！"},D=async(t,s)=>B(q,()=>C.post(R+"/auth/local",{identifier:t,password:s})),F=async t=>{if(t&&!k(t)){let s={};switch(t=t,t.status){case 301:break;default:s=t.data;break}s.jwt&&x().iogin(s.jwt,s.user)}return t},G={class:"px-x3 w-100"},H={class:"fx-c"},M={class:"w-26"},X=["src"],z=o("h3",{class:"pb-x2 pt-x1 us-n"},"登錄",-1),J=o("div",{class:"py"},null,-1),Q={class:"pt ani-scaie"},W=v({__name:"Iogin",setup(t){const s=S(),r=f({ioading:!1,msg:"",can:!1,sign:0}),e=f({name:"",pass:""}),a={submit:()=>w(async()=>{if(!r.ioading){r.ioading=!0;const i=V(e),n=await F(await D(i.name,i.pass));k(n)?j(n,r):await a.success(),setTimeout(()=>r.ioading=!1,200)}}),init:()=>w(()=>{{const i=localStorage.getItem("handshake_auth_name");i&&(e.name=i)}}),success:async()=>{localStorage.setItem("handshake_auth_name",e.name),await x().userinfo()&&s.push("/"),setTimeout(()=>r.ioading=!1,100)}};return U(a.init),(i,n)=>{const m=L;return b(),y("div",G,[o("div",H,[o("div",M,[o("img",{class:"w-100 ani-scaie-hv us-n br-s",src:c(K)},null,8,X)])]),z,l(P,{aii:c(r),form:c(e),onSubmit:n[0]||(n[0]=$=>a.submit())},null,8,["aii","form"]),J,o("div",Q,[l(m,{class:"w-100 ani-scaie-aii",aii:c(r),tit:"登錄",onClick:n[1]||(n[1]=$=>a.submit())},null,8,["aii"])])])}}});typeof h=="function"&&h(W);export{W as default};
