import{q as T,v as V,x as E,E as M,d as $,g as D,i as c,o as d,c as f,y,a as s,b as u,k as O,h as B,n as N,z as F,w as m,A as x,e as H,t as r,B as z,C as I,D as K,F as b,s as U,f as G,p as C,G as w,H as L}from"./index-4cfd176e.js";import{_ as A}from"./Itemdash.vue_vue_type_script_setup_true_lang-84f77c84.js";import{_ as P}from"./OIoadCir.vue_vue_type_script_setup_true_lang-25fee3d6.js";import{_ as j}from"./BtnIcon.vue_vue_type_script_setup_true_lang-4461ee34.js";import{v}from"./vai_order-83dced9f.js";import{f as g}from"./fioat-7d61d7cc.js";import{_ as J}from"./IayoutTabie.vue_vue_type_script_setup_true_lang-8d9268b0.js";import{_ as Q}from"./itembdwrapper.vue_vue_type_script_setup_true_lang-8b4d9f17.js";import{_ as W,a as X}from"./CoWarehouseSeiectPure.vue_vue_type_script_setup_true_lang-352bb87e.js";import{_ as Y}from"./OCheckOne.vue_vue_type_script_setup_true_lang-d1bf5f92.js";import{p as S}from"./pageOrderPina-766cc337.js";import{m as q,v as Z}from"./view-14b7197e.js";import{_ as ss}from"./OBtnSave.vue_vue_type_script_setup_true_lang-8bf7b1f8.js";import{_ as ts}from"./CkClipboard.vue_vue_type_script_setup_true_lang-315f7921.js";const es="refund",ut=async(h,l)=>T(M,async()=>V(await E.put(es,h,l+""))),is={key:0},os={key:1,class:"__checkbox_ioading"},ns=$({__name:"OCheckAii",props:{form:{},pk:{},minus:{}},emits:["resuit"],setup(h,{emit:l}){const e=h,o=D({ioading:!1}),a=()=>O(()=>{o.ioading=!0,e.form[e.pk]=!e.form[e.pk],l("resuit",e.form[e.pk]),setTimeout(()=>o.ioading=!1,e.minus?e.minus:300)});return(i,t)=>{const n=j,_=P;return c(o).ioading?(d(),f("div",os,[s("div",null,[u(_)])])):(d(),f("div",is,[i.form[i.pk]?(d(),y(n,{key:0,onClick:a,class:"h6 ani-scaie-aii",ciass_i:"h4",icon:"check-circie"})):(d(),y(n,{key:1,onClick:a,class:"h6 __checkbox_empty ani-scaie-aii",ciass_i:"h3",icon:"stop"}))]))}}}),as={class:"w-100 ta-i"},rs={class:"td fs-s"},ds={class:"w-28 fx-i fs pi-x2"},cs={class:"mw-2em pr"},_s={class:"fx-1"},us={class:"w-11"},ls={class:"w-8"},fs={class:"w-10"},ps={class:"w-9"},ms={class:"w-10 pr"},hs={class:"w-11 pi"},vs={class:"w-13"},ys=["onUpdate:modelValue"],$s=s("div",{class:"py-x3"},null,-1),ws=$({__name:"OrderRefundIistTabie",props:{aii:{}},setup(h){const l=h,e=S();return B(l.aii.chooses,o=>{e.ciear_product_refund(),o.length>0&&l.aii.many.map(a=>{o.map(i=>{a.id==i&&e.pius_product_refund(a)})})}),N(()=>F(l.aii,[{ciass:"w-28 h6",tit:"商品名稱"},{ciass:"w-11 h6",tit:"樣式"},{ciass:"w-8 h6",tit:"單價"},{ciass:"w-10 h6",tit:"折扣%"},{ciass:"w-9 h6",tit:"減價"},{ciass:"w-10 h6",tit:"總金額"},{ciass:"w-11 h6",tit:"退款數量"},{ciass:"w-13 h6 fx-c",tit:"退款金額"}])),(o,a)=>{const i=Y,t=W,n=Q,_=J;return d(),y(_,{aii:o.aii,mini:!0,pure:!0},{default:m(()=>[(d(!0),f(b,null,x(o.aii.many,(p,R)=>(d(),f("div",{key:R,class:"py-s"},[u(n,{class:K(["ani-scaie-hv py-0",{"bg-con-x2":p.__can_refunded_quantity<=0}])},{default:m(()=>[s("div",as,[s("div",rs,[s("div",ds,[s("div",cs,[p.__can_refunded_quantity>0?(d(),y(i,{key:0,chooses:o.aii.chooses,id:p.id,totai:o.aii.many.length,onChoosAii:a[0]||(a[0]=k=>o.aii.chooseAii=k)},null,8,["chooses","id","totai"])):H("",!0)]),s("div",_s,r(c(v).order_product(p).name),1)]),s("div",us,r(c(v).order_product_variation(p).name),1),s("div",ls,r(p.selling_price),1),s("div",fs,r(p.__discount_rate),1),s("div",ps,"- "+r(p.discount_deduction),1),s("div",ms,r(c(q)(p.total_price)),1),s("div",hs,r(p.__can_refunded_quantity)+" ",1),s("div",vs,[u(t,{class:"w-100"},{default:m(()=>[z(s("input",{class:"txt-money fw-900 ta-c","onUpdate:modelValue":k=>p.refunded_price=k,type:"number",placeholder:"請輸入"},null,8,ys),[[I,p.refunded_price]])]),_:2},1024)])])])]),_:2},1032,["class"])]))),128)),$s]),_:1},8,["aii"])}}}),gs={class:"w-38 fx-i py-s"},ks={class:"pi-x2 pr-x1 h6"},xs=s("h6",null,"全選",-1),bs=s("h6",{class:"fx-1 py-s"}," 退款產品列表 ",-1),lt=$({__name:"OrderRefundIist",props:{order:{}},setup(h,{expose:l}){const e=D({chooseAii:!1,chooses:[],many_origin:[],pager:{page:1,pageCount:1,pageSize:25,total:1},choose:!1,many:[],ioading:!0,msg:"",trs:[],condition:{}}),o={rate:(a,i)=>{let t=g.floatDiv(a,g.floatAdd(a,i));if(t){const n=t.toString().split(".");if(n.length>1&&n[1].toString().length>1)return t.toFixed(2)}return t||""},effect:(a={})=>{const i=a.ordered_product?a.ordered_product:[];i.length>0&&(e.many.length=0,i.map(t=>{t.__can_refunded_quantity=v.can_refund_num(t),t.__discount_rate=o.rate(t.total_price,t.discount_deduction),t.refunded_quantity=t.__can_refunded_quantity,t.refunded_price=t.total_price,t.__refunded_price_after_aii_discount=0,e.many.push(t)}),e.ioading=!1),console.log("aii.many =",e.many)},choosAii:a=>O(()=>{e.chooses.length=0,a&&e.many.map(i=>{e.chooses.push(i.id)})})};return l(o),(a,i)=>{const t=ns,n=A;return d(),f("div",null,[u(n,{class:"fx-s mb-s"},{default:m(()=>[s("div",gs,[s("div",ks,[u(t,{onResuit:o.choosAii,form:c(e),pk:"chooseAii"},null,8,["onResuit","form"])]),xs]),bs]),_:1}),u(ws,{aii:c(e)},null,8,["aii"])])}}}),qs={class:"fx-s"},As={class:"txt-money err d-ib fw-900"},Rs={class:"fx-s mt"},ft=$({__name:"RefundRightBottom",props:{form:{},me:{}},emits:["submit"],setup(h,{expose:l}){const e=h,{one_of_refund:o,refund_products:a}=U(S()),i=G(0);return B(()=>a.value,t=>{let n=0;t.map(_=>{_.refunded_quantity>0&&_.__can_refunded_quantity>0&&(n=g.floatAdd(_.refunded_price,n))}),i.value=g.numberFixed(n)},{deep:!0}),l({buiid:(t=[])=>{e.form.refunded_remarks=o.value.refunded_remarks;const n=a.value;return n.length<=0?(C("請選擇要退款的商品！！！",e.me),null):(n.map(_=>{_.refunded_quantity>0&&_.__can_refunded_quantity>0&&t.push({refunded_price:_.refunded_price,refunded_quantity:_.refunded_quantity,product:v.order_product(_).id,variation:v.order_product_variation(_).id})}),t.length<=0?(C("請注意產品的退款數量！！！",e.me),null):(e.form.refunded_info=t,e.form.storehouse?e.form:(C("請選擇一個退貨倉庫！！！",e.me),null)))}}),(t,n)=>{const _=X,p=A,R=ss;return d(),f("div",null,[u(p,null,{default:m(()=>[s("div",qs,[s("h6",null,[w("退款總金額:    "),s("p",As,"HKD "+r(c(q)(c(i))),1)]),s("div",null,[u(_,{form:t.form,pk:"storehouse",tit_def:"-- 請選擇退貨倉庫 --"},null,8,["form"])])])]),_:1}),s("div",Rs,[u(R,{class:"w-100 ani-scaie-aii",aii:t.me,onClick:n[0]||(n[0]=k=>t.$emit("submit")),tit:"退款"},null,8,["aii"])])])}}}),Cs=s("div",{class:"fw-700"},"優惠信息",-1),Ds={class:"pt"},Os={class:"w-35"},Bs={key:0,class:"d-ib"},Ns={key:1,class:"d-ib"},Ss={class:"fx-1"},Ts=s("div",{class:"fw-700 pt"},"全單優惠計算結果",-1),Vs={class:"pt"},Es={class:"d-ib"},Ms=$({__name:"RefundDiscountMsgCard",props:{order:{}},setup(h){const l=h,e=L(()=>{const o=l.order;let i=o.total_price;return o.discount.map(n=>{i=g.floatAdd(n.discount_deduction,i)}),i});return(o,a)=>{const i=A;return c(v).discounts(o.order).length>0?(d(),y(i,{key:0,class:"px mt-s ani-softer bg-card br-s ani-scaie-hv"},{default:m(()=>[Cs,s("div",Ds,[(d(!0),f(b,null,x(c(v).discounts(o.order),(t,n)=>(d(),f("div",{class:"fx-s ta-r ani-softer",key:n},[s("div",null,r(t.type)+":   ",1),s("div",Os,[t.discount_shown&&t.discount_shown!=1?(d(),f("div",Bs,r(t.discount_shown)+"  折扣",1)):(d(),f("div",Ns))]),s("div",Ss,"- "+r(t.discount_deduction)+"  HKD",1)]))),128))]),Ts,s("div",Vs,[w(r(c(e))+"  ",1),s("div",Es,[(d(!0),f(b,null,x(c(v).discounts(o.order),(t,n)=>(d(),f("div",{class:"d-ib ani-softer",key:n}," - "+r(t.discount_deduction)+"  ",1))),128))]),w(" =  "+r(o.order.total_price)+"  ",1)])]),_:1})):(d(),y(i,{key:1,class:"px mt-s ani-softer bg-card br-s ani-scaie-hv"},{default:m(()=>[w(" 該訂單未有任何全單優惠 ")]),_:1}))}}}),Fs=s("div",{class:"fw-700"},"訂單編號",-1),Hs=s("div",{class:"fw-700"},"掛單時間",-1),zs=s("div",{class:"fw-700"},"訂單狀態",-1),Is=s("div",{class:"fw-700"},"訂單金額",-1),Ks=s("div",{class:"fw-700"},"收銀員",-1),Us=s("div",{class:"fw-700"},"客戶",-1),Gs={class:"fx-s fx-t px mt-s py"},Ls=s("div",{class:"fw-700"},"支付方式",-1),Ps={class:""},js={class:"ta-r"},Js={class:"fw-b mw-4em"},Qs={class:"pt-x2 pb"},Ws=s("div",{class:"py-x3"},null,-1),pt=$({__name:"OrderRefundOrderMsg",props:{order:{}},setup(h){const l=h;return N(()=>console.log(l.order)),(e,o)=>{const a=ts,i=A;return d(),f("aside",null,[u(i,{class:"fx-s px mt-s"},{default:m(()=>[Fs,s("div",null,[w(r(e.order.order_id)+"   ",1),u(a,{txt:e.order.order_id},null,8,["txt"])])]),_:1}),u(i,{class:"fx-s px mt-s"},{default:m(()=>[Hs,s("div",null,r(c(Z)(e.order.order_date)),1)]),_:1}),u(i,{class:"fx-s px mt-s"},{default:m(()=>[zs,s("div",null,r(c(v).status(e.order)),1)]),_:1}),u(i,{class:"fx-s px mt-s"},{default:m(()=>[Is,s("div",null,r(c(q)(e.order.total_price))+"  HKD",1)]),_:1}),u(i,{class:"fx-s px mt-s"},{default:m(()=>[Ks,s("div",null,r(c(v).cashier(e.order)),1)]),_:1}),u(i,{class:"fx-s px mt-s"},{default:m(()=>[Us,s("div",null,r(c(v).member(e.order)),1)]),_:1}),s("div",Gs,[Ls,s("div",Ps,[(d(!0),f(b,null,x(c(v).payment(e.order),(t,n)=>(d(),f("div",{class:"fx-r ta-r ani-softer",key:n},[s("div",js,r(t.name)+":   ",1),s("div",Js,r(c(q)(t.price)),1)]))),128))])]),s("div",Qs,[u(Ms,{order:e.order},null,8,["order"])]),Ws])}}});export{pt as _,lt as a,ft as b,ut as s};
