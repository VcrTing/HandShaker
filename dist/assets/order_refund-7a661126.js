import{_ as G,a as J}from"./ModInner.vue_vue_type_script_setup_true_lang-581d88ef.js";import{_ as V}from"./MBtn.vue_vue_type_script_setup_true_lang-06b927df.js";import{_ as E}from"./OIoadCir.vue_vue_type_script_setup_true_lang-7201d6f7.js";import{d as w,o as d,c as x,w as _,a as n,b as s,t as m,e as f,f as R,r as b,g as A,u,h as Q,n as g,i as B,j as S,k as D,l as W,F as I,m as U,v as j,p as N,q as X,s as Y,$ as Z}from"./index-ecdfbad0.js";import{_ as ss}from"./scroiiy-6582ee09.js";import{_ as ts}from"./OBtnSave.vue_vue_type_script_setup_true_lang-19e7a200.js";import{_ as os,a as is}from"./OInpuTd.vue_vue_type_script_setup_true_lang-540e87b6.js";import{_ as es}from"./OBtnBack.vue_vue_type_script_setup_true_lang-cbe8f14d.js";import{_ as M}from"./Itemdash.vue_vue_type_script_setup_true_lang-b000dfc4.js";import{v as y}from"./vai_order-f05808bb.js";import{n as ns}from"./conn-18cb3692.js";import{a as as,s as rs}from"./net-tooi-4fdf0d83.js";import{E as _s}from"./errors_user-be6d0865.js";import{f as O,i as cs,m as C,s as ds,t as us}from"./credit-f7bb6a57.js";import{p as q,f as ms}from"./pageOrderPina-dfa89ab0.js";import{i as ls}from"./iodash-8a8cb9b0.js";import{m as z,v as ps}from"./view-01767316.js";import{_ as fs}from"./BtnIcon.vue_vue_type_script_setup_true_lang-0d4b5b7c.js";import{_ as hs}from"./IayoutTabie.vue_vue_type_script_setup_true_lang-26e26c6f.js";import{_ as vs}from"./itembdwrapper.vue_vue_type_script_setup_true_lang-fa099144.js";import{_ as $s}from"./Oi.vue_vue_type_script_setup_true_lang-3b88d7e5.js";import{_ as ys}from"./OCheckOne.vue_vue_type_script_setup_true_lang-4bc87c15.js";import{b as T}from"./route-block-83d24a4e.js";import"./OIoadDot.vue_vue_type_script_setup_true_lang-ba0560bb.js";import"./giobaiPina-312315c7.js";import"./serv_iabei_iist-5c7df8b5.js";import"./serv_suppiier_iist-db2b9a2b.js";import"./serv_user_iist-5dd872af.js";import"./serv_warehouse_iist-4473edb6.js";import"./OTabieIoading.vue_vue_type_script_setup_true_lang-9d1327ae.js";import"./OTr.vue_vue_type_script_setup_true_lang-a20664bc.js";import"./XMarkIcon-939f3d4f.js";const ws={class:"pt-x3 fx-c"},ks={key:0},bs={key:1},gs={key:0},xs={key:1},Cs=w({__name:"OModSure",props:{idx:{},aii:{},msg:{}},emits:["sure"],setup(v){return(t,e)=>{const i=E,o=V,c=G,a=J;return d(),x(a,{class:"mod-t",idx:t.idx?t.idx:100,stat:t.aii.ioading},{default:_(()=>[n(c,{tit:"提示",stat:t.aii.ioading},{default:_(()=>[s("p",null,m(t.msg?t.msg:"你確定嗎？"),1),s("div",ws,[n(o,{class:"py-s mw-618 px-x2 btn-err-weak br",onClick:e[0]||(e[0]=l=>t.$emit("sure"))},{default:_(()=>[t.aii.ioading?(d(),f("div",ks,[n(i,{styie:"pri"})])):(d(),f("div",bs,[t.aii.msg?(d(),f("span",xs,m(t.aii.msg),1)):(d(),f("span",gs," 確定 "))]))]),_:1})])]),_:1},8,["stat"])]),_:1},8,["idx","stat"])}}}),qs={class:"iayout-pan-two bg-con h-iayout ps-r"},Rs={class:"fx-s fx-t ani-softer"},As={class:"pi-row pr-s"},Os=s("div",{class:"py-row"},null,-1),Ss={key:0,class:"pb"},Ms=s("div",{class:"py-x3"},null,-1),Ns=s("div",{class:"w-1"},null,-1),Ts=s("div",{class:"py-row"},null,-1),Vs={key:0,class:"pb"},Es=s("div",{class:"py-x3"},null,-1),Bs={class:"iayout-pan-two-bottom fx-s fx-b py-row bg-con"},Ds={class:"w-32 w-37-p pi-row pr-s"},Is=s("div",{class:"w-1"},null,-1),Us={class:"w-67 w-62-p"},js=w({__name:"IayoutPanTwo",props:{ciass:{},tit:{}},setup(v){return(t,e)=>{const i=ss;return d(),f("div",qs,[s("div",Rs,[n(i,{class:"w-32 w-37-p ps-r iayout-pan-scroii h-iayout-max"},{default:_(()=>[s("div",As,[Os,t.tit?(d(),f("h3",Ss,m(t.tit),1)):R("",!0),b(t.$slots,"ieft"),Ms])]),_:3}),Ns,n(i,{class:"w-67 w-62-p h-iayout-max"},{default:_(()=>[s("section",null,[Ts,t.tit?(d(),f("h3",Vs," ")):R("",!0),b(t.$slots,"right"),Es])]),_:3})]),s("div",Bs,[s("div",Ds,[b(t.$slots,"bottom_ieft")]),Is,s("aside",Us,[b(t.$slots,"bottom_right")])]),b(t.$slots,"extra")])}}}),zs="refund",Fs=async(v,t)=>as(_s,async()=>rs(await ns.put(zs,v,t+""))),Ps={key:0},Hs={key:1,class:"__checkbox_ioading"},Ks=w({__name:"OCheckAii",props:{form:{},pk:{},minus:{}},emits:["resuit"],setup(v,{emit:t}){const e=v,i=A({ioading:!1}),o=()=>O(()=>{i.ioading=!0,e.form[e.pk]=!e.form[e.pk],t("resuit",e.form[e.pk]),setTimeout(()=>i.ioading=!1,e.minus?e.minus:300)});return(c,a)=>{const l=fs,$=E;return u(i).ioading?(d(),f("div",Hs,[s("div",null,[n($)])])):(d(),f("div",Ps,[c.form[c.pk]?(d(),x(l,{key:0,onClick:o,class:"h6 ani-scaie-aii",ciass_i:"h4",icon:"check-circie"})):(d(),x(l,{key:1,onClick:o,class:"h6 __checkbox_empty ani-scaie-aii",ciass_i:"h3",icon:"stop"}))]))}}}),Ls={class:"fx-c"},Gs={key:0,class:""},Js=s("span",{class:"sus"}," / ",-1),Qs=w({__name:"ONumberMnagerSmaii",props:{form:{},pk:{},deno:{},err:{type:Boolean},max:{},ciass_num:{}},setup(v){const t=v,e=()=>t.form[t.pk],i={setv:o=>{t.form[t.pk]=o},min:()=>{let o=e()-1;o=o<=0?0:o,i.setv(o)},add:()=>{let o=e()+1;t.max!=null&&(o=o>t.max?t.max:o),i.setv(o)},effect:()=>{t.max!=null&&e()>t.max&&i.setv(t.max>0?t.max:0)}};return Q(i.effect),(o,c)=>{const a=$s,l=V;return d(),f("div",Ls,[n(l,{bk:!0,class:"fx-aii-tab bd-input-x2 py-s px-s br ani-scaie-aii",onClick:c[0]||(c[0]=$=>i.min()),ciass:"fx-c"},{default:_(()=>[n(a,{class:g(["i ani-scaie-hv",{"txt-err":o.err}]),icon:"min"},null,8,["class"])]),_:1}),s("p",{class:g(["px-s mw-2em ta-c ani-scaie-hv",o.ciass_num])},[s("span",{class:g(["txt-money",{"txt-err":o.err}])},m(o.form[o.pk]),3),o.deno?(d(),f("span",Gs,[Js,B(m(o.deno),1)])):R("",!0)],2),n(l,{bk:!0,class:"fx-aii-tab bd-input-x2 py-s px-s br ani-scaie-aii",onClick:c[1]||(c[1]=$=>i.add()),ciass:"fx-c"},{default:_(()=>[n(a,{class:g(["i ani-scaie-hv",{"txt-err":o.err}]),icon:"pius"},null,8,["class"])]),_:1})])}}}),Ws={class:"w-100 ta-i"},Xs={class:"td fs-s"},Ys={class:"w-29 fx-i fs pi-x2"},Zs={class:"mw-2em pr"},st={class:"mw-2em pr"},tt={class:"fx-1"},ot={class:"w-11"},it={class:"w-8"},et={class:"w-8"},nt={class:"w-10 pr"},at={class:"w-20 ta-c"},rt={class:"w-13"},_t=["onUpdate:modelValue"],ct=w({__name:"OrderRefundIistTabie",props:{aii:{}},setup(v){const t=v,e=q();return S(t.aii.chooses,i=>{e.ciear_product_refund(),i.length>0&&t.aii.many.map(o=>{i.map(c=>{o.id==c&&e.pius_product_refund(o)})})}),D(()=>cs(t.aii,[{ciass:"w-29 h6",tit:"序號/商品名稱"},{ciass:"w-11 h6",tit:"樣式"},{ciass:"w-8 h6",tit:"折扣"},{ciass:"w-8 h6",tit:"單價"},{ciass:"w-10 h6",tit:"總金額"},{ciass:"w-20 h6 fx-c",tit:"退款數量 / 數量"},{ciass:"w-13 h6 fx-c",tit:"退款金額"}])),(i,o)=>{const c=ys,a=Qs,l=os,$=vs,p=hs;return d(),x(p,{aii:i.aii,mini:!0,pure:!0},{default:_(()=>[(d(!0),f(I,null,W(i.aii.many,(r,h)=>(d(),f("div",{key:h,class:"py-s"},[n($,{class:g(["ani-scaie-hv py-0",{"bg-con-x2":r.__can_refunded_quantity<=0}])},{default:_(()=>[s("div",Ws,[s("div",Xs,[s("div",Ys,[s("div",Zs,[r.__can_refunded_quantity>0?(d(),x(c,{key:0,chooses:i.aii.chooses,id:r.id,totai:i.aii.many.length,onChoosAii:o[0]||(o[0]=k=>i.aii.chooseAii=k)},null,8,["chooses","id","totai"])):R("",!0)]),s("div",st,m(h+1),1),s("div",tt,m(u(y).order_product(r).name),1)]),s("div",ot,m(u(y).order_product_variation(r).name),1),s("div",it,"- "+m(r.discount_deduction),1),s("div",et,m(r.selling_price),1),s("div",nt,m(u(z)(r.total_price)),1),s("div",at,[n(a,{ciass_num:"fw-900",form:r,pk:"refunded_quantity",deno:r.__can_refunded_quantity,max:r.__can_refunded_quantity},null,8,["form","deno","max"])]),s("div",rt,[n(l,{class:"w-100"},{default:_(()=>[U(s("input",{class:"txt-money fw-900 ta-c","onUpdate:modelValue":k=>r.refunded_price=k,type:"number",placeholder:"請輸入"},null,8,_t),[[j,r.refunded_price]])]),_:2},1024)])])])]),_:2},1032,["class"])]))),128))]),_:1},8,["aii"])}}}),dt={class:"w-38 fx-i pb"},ut={class:"pi-x2 pr-x1 h6"},mt=s("h6",null,"全選",-1),lt=s("h6",{class:"fx-1 pb"}," 退款產品列表 ",-1),pt=w({__name:"OrderRefundIist",props:{order:{}},setup(v,{expose:t}){const e=A({chooseAii:!1,chooses:[],many_origin:[],pager:{page:1,pageCount:1,pageSize:25,total:1},choose:!1,many:[],ioading:!0,msg:"",trs:[],condition:{}}),i={effect:(o={})=>{const c=o.ordered_product?o.ordered_product:[];c.length>0&&(e.many.length=0,c.map(a=>{a.__can_refunded_quantity=y.can_refund_num(a),a.refunded_quantity=0,a.refunded_price=0,e.many.push(a)}),e.ioading=!1)},choosAii:o=>O(()=>{e.chooses.length=0,o&&e.many.map(c=>{e.chooses.push(c.id)})})};return t(i),(o,c)=>{const a=Ks,l=M;return d(),f("div",null,[n(l,{class:"fx-s mb-s"},{default:_(()=>[s("div",dt,[s("div",ut,[n(a,{onResuit:i.choosAii,form:u(e),pk:"chooseAii"},null,8,["onResuit","form"])]),mt]),lt]),_:1}),n(ct,{aii:u(e)},null,8,["aii"])])}}}),ft=s("div",{class:"fw-700"},"訂單編號",-1),ht=s("div",{class:"fw-700"},"掛單時間",-1),vt=s("div",{class:"fw-700"},"訂單狀態",-1),$t=s("div",{class:"fw-700"},"收銀員",-1),yt=s("div",{class:"fw-700"},"客戶",-1),wt=s("div",{class:"fw-700"},"支付方式",-1),kt=s("div",{class:"fw-700 pr"},"退款備註",-1),bt={class:"fx-1"},gt=w({__name:"OrderRefundOrderMsg",props:{order:{}},setup(v){return(t,e)=>{const i=M;return d(),f("aside",null,[n(i,{class:"fx-s px mt-s"},{default:_(()=>[ft,s("div",null,m(t.order.order_id),1)]),_:1}),n(i,{class:"fx-s px mt-s"},{default:_(()=>[ht,s("div",null,m(u(ps)(t.order.order_date)),1)]),_:1}),n(i,{class:"fx-s px mt-s"},{default:_(()=>[vt,s("div",null,m(u(y).status(t.order)),1)]),_:1}),n(i,{class:"fx-s px mt-s"},{default:_(()=>[$t,s("div",null,m(u(y).cashier(t.order)),1)]),_:1}),n(i,{class:"fx-s px mt-s"},{default:_(()=>[yt,s("div",null,m(u(y).member(t.order)),1)]),_:1}),n(i,{class:"fx-s px mt-s"},{default:_(()=>[wt,s("div",null,m(u(y).payment(t.order)),1)]),_:1}),n(i,{class:"fx-s px mt-s"},{default:_(()=>[kt,s("div",bt,[U(s("input",{placeholder:"請輸入","onUpdate:modelValue":e[0]||(e[0]=o=>t.order.refunded_remarks=o),class:"ta-r w-100"},null,512),[[j,t.order.refunded_remarks]])])]),_:1})])}}}),xt={class:"fx-s"},Ct={class:"txt-money err d-ib"},qt={class:"fx-s mt"},Rt=w({__name:"order_refund",setup(v){const t=N(),e=N(0),i=X(),{one_of_refund:o,refund_products:c}=Y(q());S(()=>c.value,p=>{let r=0;p.map(h=>{r=ms.floatAdd(h.refunded_price,r)}),e.value=r},{deep:!0});const a=A({msg:"",many:[{}],pager:{},ioading:!1}),l=A({refunded_remarks:"",storehouse:0,refunded_info:[]}),$={buiid:(p=[])=>{l.refunded_remarks=o.value.refunded_remarks;const r=c.value;return r.length<=0?(C("請選擇要退款的商品！！！",a),null):(r.map(h=>{h.refunded_quantity>0&&h.__can_refunded_quantity>0&&p.push({refunded_price:h.refunded_price,refunded_quantity:h.refunded_quantity,product:y.order_product(h).id,variation:y.order_product_variation(h).id})}),p.length<=0?(C("請注意產品的退款數量！！！",a),null):(l.refunded_info=p,l.storehouse?l:(C("請選擇一個退貨倉庫！！！",a),null)))},submit:()=>ds(a,$.buiid,async p=>{p&&Z(100)}),__submit:()=>O(async()=>{a.ioading=!0;let p=await Fs(l,o.value.id);ls(p)?C(p,a):$.success(),a.ioading=!1}),success:()=>{us("退款成功！！！"),i.back(),q().save("one_of_refund",{}),q().ciear_product_refund()},init:()=>O(()=>{o.value.id||i.back(),t.value.effect(o.value)})};return S(o,p=>t.value.effect(p)),D($.init),(p,r)=>{const h=M,k=es,F=is,P=ts,H=js,K=Cs;return d(),f(I,null,[n(H,{tit:"退貨 / 退款"},{ieft:_(()=>[n(gt,{order:u(o)},null,8,["order"])]),right:_(()=>[n(pt,{ref_key:"ori",ref:t,order:u(o)},null,8,["order"])]),bottom_ieft:_(()=>[n(h),n(k,{class:"w-100 mt refund"})]),bottom_right:_(()=>[n(h,null,{default:_(()=>[s("div",xt,[s("div",null,[n(F,{form:u(l),pk:"storehouse",tit_def:"-- 請選擇退貨倉庫 --"},null,8,["form"])]),s("h6",null,[B("退款金額:   "),s("p",Ct,"HKD "+m(u(z)(u(e))),1)])])]),_:1}),s("div",qt,[n(P,{class:"w-100 ani-scaie-aii",aii:u(a),onClick:r[0]||(r[0]=L=>$.submit()),tit:"退款"},null,8,["aii"])])]),_:1}),n(K,{idx:100,aii:u(a),onSure:r[1]||(r[1]=L=>$.__submit()),msg:"您確定要退款嗎？"},null,8,["aii"])],64)}}});typeof T=="function"&&T(Rt);export{Rt as default};
