import{_ as z}from"./IayoutPan.vue_vue_type_script_setup_true_lang-36a374fb.js";import{_ as G}from"./ModInner.vue_vue_type_script_setup_true_lang-ec02f4d3.js";import{d as B,o as _,y as x,w as m,r as R,c as p,a as n,i as u,b as a,H as E,t as O,g as M,a8 as P,h as D,B as y,C as A,ag as I,u as X,X as L,F,A as U,D as q,a9 as W,e as $,k as C,m as j,s as K,n as ss,z as ts,R as is,N as es,$ as T,q as os,v as ns,x as as,f as rs,ab as _s,a4 as S,j as cs,a0 as ls,p as ds,l as us}from"./index-c02dffd3.js";import{_ as Y}from"./OBtnSave.vue_vue_type_script_setup_true_lang-1dd96f5b.js";import{f as k}from"./fioat-7d61d7cc.js";import{_ as Z}from"./IayoutForm.vue_vue_type_script_setup_true_lang-8af5e41e.js";import{a as ps,_ as ms}from"./CoWarehouseSeiectPure.vue_vue_type_script_setup_true_lang-cd76a0ef.js";import{_ as fs}from"./OInput.vue_vue_type_script_setup_true_lang-53c6d8bb.js";import{_ as vs}from"./CoSuppiierSeiectPure.vue_vue_type_script_setup_true_lang-dc92a038.js";import{_ as ws}from"./OInputI.vue_vue_type_script_setup_true_lang-8917e070.js";import{_ as hs}from"./OTime.vue_vue_type_script_setup_true_lang-5246e0f8.js";import{_ as ys}from"./OModTrash.vue_vue_type_script_setup_true_lang-c787b268.js";import{b as As,_ as gs}from"./IayoutTabie.vue_vue_type_script_setup_true_lang-e1a1f6ff.js";import{_ as bs}from"./BtnTab.vue_vue_type_script_setup_true_lang-186bd304.js";import{_ as J}from"./BtnIcon.vue_vue_type_script_setup_true_lang-14cd32dc.js";import{_ as $s}from"./BtnIconX2.vue_vue_type_script_setup_true_lang-b3484037.js";import{_ as ks}from"./MBtn.vue_vue_type_script_setup_true_lang-686a7428.js";import{_ as Cs}from"./OIoadCir.vue_vue_type_script_setup_true_lang-f96beb73.js";import{_ as Bs}from"./Oi.vue_vue_type_script_setup_true_lang-c317e4c1.js";import{invoiceCreatPina as N}from"./invoiceCreatPina-d66f197f.js";import{E as Vs}from"./errors_product-d5275ad5.js";import{b as Q}from"./route-block-83d24a4e.js";import"./OIoadDot.vue_vue_type_script_setup_true_lang-3d4cbf47.js";import"./giobaiPina-03474086.js";import"./serv_suppiier_iist-0c51d78f.js";import"./serv_user_iist-87626e74.js";import"./serv_warehouse_iist-7383a4ad.js";import"./datepicker.esm-193264dc.js";import"./InboxIcon-8a908564.js";import"./OTr.vue_vue_type_script_setup_true_lang-bd0f3b05.js";import"./OiX2.vue_vue_type_script_setup_true_lang-e940ced6.js";import"./DocumentTextIcon-949aeb5b.js";import"./PlusCircleIcon-f4e496c4.js";import"./XMarkIcon-99b1c700.js";import"./serv_product_iist-912b790e.js";const xs=B({__name:"OModPure",props:{idx:{},aii:{},msg:{}},emits:["sure"],setup(h){return(o,v)=>{const d=G;return _(),x(d,{class:"mod-s",idx:o.idx?o.idx:100,stat:o.aii.ioading,pure:!0},{default:m(()=>[R(o.$slots,"default")]),_:3},8,["idx","stat"])}}}),Ds="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALeSURBVHgB7ZtBctMwFIb/5zRdQSdHMDuGKSU3aHKCdkGgO5ITlJ6AcgLICUi2FGZygyQnaIYybMkRyhawH89OFikOiV3JT6XWN5NkImtk6bf0JD09Ax6Px1NhCI7gp52u/Bymf4gm9OXjEA5QF4DD4wYe1Mdy5yZu1mSG4FebZqNrKBJAm73dN5nGJ7Ck/d55DWX0BWA+/uc1olMooy8AEG641oAyLgS4U6gYwdTwPawnXT+x+t3NuWkktRppzQqlCpA2fG/3VMZ9YtyKdu+52IQBgp/9MmeG0gTg/ectacAHbB7zeZiLgD36+mmCEijFBvDBC5nqaAzzxiMtQ8pKyywB6z0grSjzOcqA6Fxsw1tYxKoAfPBSxnv8HmVCdCYiWLuHNQH48UmIevQd5XONCG36djGDBezZgHo0hg4N1PAOlrAiwHJnF0KPltiaV7CArR5QioXeCHMXFjC2Afyk05QueYliDOQz/aukllSn2FNlbpuuD3ZgCqUVRyEiTMWIDVaTZBglPwUFSLfVExhgPgQCOoIrAmrBEHMBiNW3sCs8gyHmAjA14Q5j8f93f0DlBTDGC4CK4wVAxfECoOKY7wVuQw2Hy7X/CrfYU1jAjQCLs4HuzSQ3B9XeBsAVzBP57smDTw5N5nCEmyHAPBNHRnslpS82IfEptqCMmx7AWHfu5yRCxJEAlD3ri934FdwIUFvj+gr0gyMSXE2DLd7vXIr8AxkOP7DwBYZwgCsBkMYJMco9RsuBjxDJm3F53r/Obd2FWwaZFOZh3vOC/EOAKIT7xq6jm0mJaYqc+KUwKs79FKDAxjK/DWCeywpugLsHZ1JI6urx5ELNDbNhHZElQt9WDNA29JbCsewAaznXEQGrbY1VHXHi9EiiyMIt2eZ0dfEISuhOg8y97ZniMyiiKsByfZ6IsC74OYn/69HV5xEUceKL5uZJiDg6kgYvgitq6ftCQ+33hTwej6fy/AGfJrsXt0lXRAAAAABJRU5ErkJggg==",Is={class:"ta-c"},Fs={class:"w-100 fx-c pt"},Ns={class:"w-30 cms-warning-icon cir fx-c ani-scaie-aii"},Us=["src"],Ms=n("div",{class:"pb-x1 px bg-con"},[n("h3",{class:"pb pt-x2"},"確認儲存？"),n("div",{class:"fx-c"},[n("p",{class:"w-64"},"確認儲存後，產品的數量將加入庫存，屆時修改產品數量需要到產品庫存頁面內修改。")])],-1),Es={class:"py px"},Os=B({__name:"CoInvoiceModSure",props:{aii:{}},emits:["save"],setup(h){return(o,v)=>{const d=Y;return _(),p("div",Is,[n("div",Fs,[n("div",Ns,[n("img",{class:"w-50 ani-scaie-aii",src:u(Ds)},null,8,Us)])]),Ms,n("div",Es,[a(d,{aii:o.aii,tit:"確認",class:"btn-warning w-100 py ani-fade-b ani-scaie-aii",onClick:v[0]||(v[0]=e=>o.$emit("save"))},null,8,["aii"])])])}}}),Ts={class:"row"},Hs={class:"w-50"},qs=n("div",null," 合計數量 ",-1),Ss={class:"pt"},Qs={class:"w-50"},Rs=n("div",null," 合計金額 ",-1),Xs={class:"pt"},js=B({__name:"OrderInTotai",props:{many:{}},setup(h){const o=h,v=E(()=>{let e=0;return o.many.map(c=>{const s=c.data_of_vars;s&&s.map(t=>{t.quantity&&(e+=t.quantity)})}),e}),d=E(()=>{let e=0;return o.many.map(c=>{const s=c.total_amount;return e=k.numberFixed(k.floatAdd(e,s)),c}),k.numberFixed(e)});return(e,c)=>(_(),p("div",Ts,[n("div",Hs,[qs,n("div",Ss,[n("h4",null,O(u(v)),1)])]),n("div",Qs,[Rs,n("div",Xs,[n("h4",null,O(u(d)),1)])])]))}}),Ks={class:"row"},Ys={class:"w-333"},Zs={class:"w-333"},Js={class:"w-333"},zs={class:"row pt"},Gs={class:"w-333"},Ps={class:"w-333"},Ls={class:"w-333"},Ws=B({__name:"OrderInCreatBase",props:{form:{},aii:{}},setup(h){const o=h,v=["supplier","storehouse","date","invoice_id"],d=M(P(o.form));return D(()=>o.aii.sign,()=>{v.map(e=>{if(I(d,e,o.form[e],o.aii)){o.aii.can=!1;return}}),o.aii.can=!0}),D(()=>o.form.date,e=>I(d,"date",e,o.aii)),D(()=>o.form.supplier,e=>I(d,"supplier",e,o.aii)),D(()=>o.form.storehouse,e=>I(d,"storehouse",e,o.aii)),D(()=>o.form.invoice_id,e=>I(d,"invoice_id",e,o.aii)),(e,c)=>{const s=hs,t=ws,i=vs,l=fs,g=ps,b=Z;return _(),x(b,{tit:"基本信息",class:"pb-x3 mb"},{default:m(()=>[n("div",Ks,[n("div",Ys,[a(t,{tit:"發票日期",err:u(d).date,icon:"date"},{default:m(()=>[a(s,{form:e.form,pk:"date"},null,8,["form"])]),_:1},8,["err"])]),n("div",Zs,[a(l,{tit:"供應商名稱",err:u(d).supplier},{default:m(()=>[a(i,{form:e.form,pk:"supplier",kiii_color:!0,tit_def:"-- 請選擇 --"},null,8,["form"])]),_:1},8,["err"])]),n("div",Js,[a(l,{tit:"入貨倉庫",err:u(d).storehouse},{default:m(()=>[a(g,{form:e.form,pk:"storehouse"},null,8,["form"])]),_:1},8,["err"])])]),n("div",zs,[n("div",Gs,[a(l,{tit:"訂單號碼",err:u(d).invoice_id},{default:m(()=>[y(n("input",{"onUpdate:modelValue":c[0]||(c[0]=r=>e.form.invoice_id=r),placeholder:"請輸入"},null,512),[[A,e.form.invoice_id]])]),_:1},8,["err"])]),n("div",Ps,[a(l,{tit:"帳單地址",err:u(d).invoice_address},{default:m(()=>[y(n("input",{"onUpdate:modelValue":c[1]||(c[1]=r=>e.form.invoice_address=r),placeholder:"請輸入"},null,512),[[A,e.form.invoice_address]])]),_:1},8,["err"])]),n("div",Ls,[a(l,{tit:"送貨地址",err:u(d).delivery_address},{default:m(()=>[y(n("input",{"onUpdate:modelValue":c[2]||(c[2]=r=>e.form.delivery_address=r),placeholder:"請輸入"},null,512),[[A,e.form.delivery_address]])]),_:1},8,["err"])])])]),_:1})}}}),st={key:0,class:"ani-softer fx-s"},tt={key:1,class:"mxh-1em ani-softer"},it=B({__name:"OBtnSearchMini",props:{ioad:{type:Boolean}},setup(h){return(o,v)=>{const d=Bs,e=Cs,c=ks;return _(),x(c,{class:"btn-pri hand br mw-4em",ciass:"fx-c"},{default:m(()=>[o.ioad?(_(),p("div",tt,[a(e,{class:"h5",styie:"wht"})])):(_(),p("div",st,[a(d,{icon:"search",class:"i h4"})]))]),_:1})}}}),et={class:"ai-fs-imp"},ot={class:"w-11"},nt={class:"w-15"},at={key:0,class:"w-15 ani-softer"},rt=["onUpdate:modelValue"],_t=["value"],ct={key:0,class:"d-ib pr pi-s"},lt={key:1,class:"d-ib pr pi-s"},dt={key:1,class:"w-8 ani-softer"},ut=["onUpdate:modelValue"],pt={key:2,class:"w-9 ani-softer"},mt={key:3,class:"w-8 ani-softer"},ft={key:4,class:"w-10 ani-softer pi"},vt=["value"],wt={key:5,class:"w-7 ani-softer"},ht=["value"],yt={key:6,class:"w-7 ani-softer"},At={key:7,class:"w-7 ani-softer"},gt={class:"fx-1 pi fx-r"},bt=B({__name:"OciiTd",props:{v:{}},setup(h){const o=h,v=X(),d=N(),e=E(()=>{const s=o.v.__product;return s&&s.id}),c={pro:()=>e.value?o.v.__product:null,search:()=>C(async()=>{const s=o.v;if(s.__ioad)return;const t=s.number?s.number.trim():void 0;if(t){s.__ioad=!0;try{let i=await d.searchPro(t);if(!j(i))i=i,i&&i.id&&c.insert_pro(i,s);else{const l=v.resolve({path:"/admin/product_inventory_iist/creat"});window.open(l.href,"_blank")}}catch{}setTimeout(()=>s.__ioad=!1,200)}}),insert_pro:(s,t)=>{t.product=s.id,t.__product=s,t.number=s.product_id,t.name=s.name,t.new_restock_price=s.new_restock_price,t.selling_price=s.new_selling_price,t.lowest_price=s.new_lowest_price,t.net_price=s.new_restock_price,t.data_of_vars||(t.data_of_vars=[]),t.data_of_vars.length<=0&&c.piusDFV()},proVariations:()=>{const s=c.pro();return s?s.variations:[]},piusDFV:()=>C(()=>{const s=d.genDFV(o.v);o.v.data_of_vars.push(s)}),trashDFV:s=>C(()=>{try{o.v.data_of_vars.splice(s,1)}catch{}})};return(s,t)=>{const i=ms,l=it,g=$s,b=J;return _(),p("div",et,[n("div",ot,[a(i,null,{default:m(()=>[y(n("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.v.number=r),onKeydown:t[1]||(t[1]=L(r=>c.search(),["enter"])),placeholder:"請輸入後按回車"},null,544),[[A,s.v.number]])]),_:1})]),n("div",nt,[u(e)?(_(),x(i,{key:0,class:"ani-softer"},{default:m(()=>[y(n("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.v.name=r),placeholder:"請輸入"},null,512),[[A,s.v.name]])]),_:1})):(_(),x(l,{key:1,class:"mi-s mh-2em",onTap:t[3]||(t[3]=r=>c.search()),ioad:s.v.__ioad},null,8,["ioad"]))]),u(e)?(_(),p("div",at,[(_(!0),p(F,null,U(s.v.data_of_vars,(r,w)=>(_(),p("div",{class:q(["w-100 fx-s ani-softer",{"pt-s":w>0}]),key:w},[a(i,{class:"fx-1"},{default:m(()=>[y(n("select",{"onUpdate:modelValue":f=>r.variation=f},[(_(!0),p(F,null,U(c.proVariations(),(f,V)=>(_(),p("option",{key:V,value:f.id},O(f.name),9,_t))),128))],8,rt),[[W,r.variation]])]),_:2},1024),w==0?(_(),p("div",ct,[a(g,{icon:"pius-c",ciass_i:"sub",onClick:t[4]||(t[4]=f=>c.piusDFV())})])):(_(),p("div",lt,[a(b,{ciass_i:"",icon:"x",onClick:f=>c.trashDFV(w)},null,8,["onClick"])]))],2))),128))])):$("",!0),u(e)?(_(),p("div",dt,[(_(!0),p(F,null,U(s.v.data_of_vars,(r,w)=>(_(),p("div",{class:q(["w-100 ani-softer",{"pt-s":w>0}]),key:w},[a(i,{err:!r.quantity},{default:m(()=>[y(n("input",{type:"number","onUpdate:modelValue":f=>r.quantity=f,placeholder:"請輸入正數"},null,8,ut),[[A,r.quantity]])]),_:2},1032,["err"])],2))),128))])):$("",!0),u(e)?(_(),p("div",pt,[a(i,{class:"bg-card"},{default:m(()=>[y(n("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=r=>s.v.price=r),placeholder:"請輸入金錢"},null,512),[[A,s.v.price]])]),_:1})])):$("",!0),u(e)?(_(),p("div",mt,[a(i,null,{default:m(()=>[y(n("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=r=>s.v.discount=r),placeholder:"0至1的小數"},null,512),[[A,s.v.discount]])]),_:1})])):$("",!0),u(e)?(_(),p("div",ft,[a(i,{class:"bd-c-t-imp"},{default:m(()=>[n("input",{value:s.v.new_stock_price,disabled:!0},null,8,vt)]),_:1})])):$("",!0),u(e)?(_(),p("div",wt,[a(i,{class:"bd-c-t-imp"},{default:m(()=>[n("input",{value:s.v.total_amount,disabled:!0},null,8,ht)]),_:1})])):$("",!0),u(e)?(_(),p("div",yt,[a(i,{class:"bg-card",err:s.v.lowest_price>s.v.selling_price},{default:m(()=>[y(n("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=r=>s.v.lowest_price=r),placeholder:"請輸入金錢"},null,512),[[A,s.v.lowest_price]])]),_:1},8,["err"])])):$("",!0),u(e)?(_(),p("div",At,[a(i,{class:"bg-card"},{default:m(()=>[y(n("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=r=>s.v.selling_price=r),placeholder:"請輸入金錢"},null,512),[[A,s.v.selling_price]])]),_:1})])):$("",!0),n("div",gt,[R(s.$slots,"default")])])}}}),$t={key:0,class:"pb-x2 ani-softer"},kt={class:"mh-input-s py-n"},Ct={key:1,class:"oti-con ani-softer"},Bt={class:"ani-fade-b"},Vt=B({__name:"OrderInCreatInIist",emits:["sureTrash"],setup(h,{emit:o}){const v=M({many:[{__edit:!0}],chooseAii:!1,chooses:[],many_origin:[],ioading:!1,msg:"",trs:[],condition:{search:""},pager:{page:1,pageCount:1,pageSize:25,total:1}}),{many:d}=K(N()),e=M({origin:{},trashIdx:0});ss(()=>ts(v,[{ciass:"w-11",tit:"貨號"},{ciass:"w-15",tit:"貨品名稱 / 摘要"},{ciass:"w-15",tit:"樣式"},{ciass:"w-8",tit:"數量"},{ciass:"w-9",tit:"單價"},{ciass:"w-8",tit:"折扣 %"},{ciass:"w-10",tit:"最新入貨價錢"},{ciass:"w-7",tit:"統計"},{ciass:"w-8",tit:"最低價錢"},{ciass:"w-6",tit:"售價"},{ciass:"fx-1",tit:""}]));const c={pius:()=>C(()=>{N().pius()}),edit:s=>C(()=>{s.__edit=!0,e.origin[s.id+""]=is(s)}),cancei:s=>C(()=>{const t=e.origin[s.id+""];t?(t.__edit=!1,es(t,s)):s.edit=!1}),sureTrash:s=>C(()=>{e.trashIdx=s,o("sureTrash",s),T(-201)}),trash:()=>C(()=>{d.value.splice(e.trashIdx,1),T(0)})};return(s,t)=>{const i=J,l=As,g=bs,b=gs,r=Z,w=ys;return _(),p(F,null,[a(r,{tit:"產品入單列表",class:"pb-x3 mb"},{default:m(()=>[a(b,{aii:u(v),mini:!0},{default:m(()=>[u(d).length>0?(_(),p("div",$t,[(_(!0),p(F,null,U(u(d),(f,V)=>(_(),p("div",{key:V,class:"ani-softer"},[f.__edit?(_(),x(bt,{key:0,class:"td",v:f},{default:m(()=>[n("div",kt,[a(i,{icon:"trash",ciass_i:"txt-err",onClick:H=>c.sureTrash(V)},null,8,["onClick"])])]),_:2},1032,["v"])):$("",!0)]))),128))])):(_(),p("div",Ct,[a(l,{class:"mh-oti-s"})])),n("div",Bt,[a(g,{onClick:t[0]||(t[0]=f=>c.pius()),class:"w-100 py-s ani-scaie-aii",tit:"添加項目"})])]),_:1},8,["aii"])]),_:1}),a(w,{idx:-201,aii:u(v),onTrash:c.trash},null,8,["aii","onTrash"])],64)}}}),xt="invoices",Dt=async h=>os(Vs,async()=>ns(await as.pos(xt,h))),It={class:"fx-r"},Ft=n("div",{class:"py-x3"},null,-1),Nt=B({__name:"invoice_creat",setup(h){const o=M({ioading:!1,msg:"",can:!1,sign:0,aiiow:!1}),{form:v,many:d}=K(N()),e=X();D(d,t=>C(()=>{t.map(i=>{if(i.product){const l=i.data_of_vars;if(l&&l.length>0){isNaN(i.price)&&(i.price=0);const g=i.price?i.price:0;(isNaN(i.discount)||i.discount>1||i.discount<0)&&(i.discount=1);const b=i.discount?i.discount:1,r=k.numberFixed(k.floatMul(g,b));let w=0;l.map(f=>{if(f){(isNaN(f.quantity)||f.quantity<0)&&(f.quantity=0);const V=f.quantity?f.quantity:0;V?o.aiiow=!0:o.aiiow=!1;const H=k.floatMul(r,V);w=k.floatAdd(H,w)}}),i.total_amount=k.numberFixed(w),i.new_stock_price=k.numberFixed(r)}}})}),{immediate:!0,deep:!0});const c=rs(0),s={buiid:()=>{if(!_s(["supplier","storehouse","date","invoice_id"],v.value))return null;if(!o.aiiow)return S("入單產品列表內，數量的值填寫不完善。"),null;let t=!0;const i={...v.value,restocks:d.value.map(l=>(l.lowest_price>l.selling_price&&(S("入貨時，最低價錢不能超過售價！！！"),t=!1),l.unit_price=l.price,l.net_price=l.new_stock_price,l.variations=l.data_of_vars,l))};return i.restocks=i.restocks.filter(l=>l&&l.data_of_vars.length>0&&l.net_price>=0),t?i:null},submit:()=>cs(o,s.buiid,async t=>{t&&T(300)}),__submit:()=>ls(o,async()=>{const t=s.buiid();if(!t||c.value==1)return;c.value=1;const i=await Dt(t);j(i)?ds(i,o):(us("產品入單成功！！！"),e.push("/admin/invoice_iist"),N().ciear()),c.value=0})};return(t,i)=>{const l=Y,g=Os,b=xs,r=z;return _(),x(r,{tit:"快速入單",ciass:"w-100"},{default:m(()=>[n("div",It,[a(l,{class:"mw-10em",aii:u(o),tit:"儲存",onClick:i[0]||(i[0]=w=>s.submit())},null,8,["aii"])]),a(Ws,{aii:u(o),form:u(v)},null,8,["aii","form"]),a(Vt),a(js,{many:u(d)},null,8,["many"]),Ft,a(b,{aii:u(o),idx:300},{default:m(()=>[a(g,{aii:u(o),onSave:i[1]||(i[1]=w=>s.__submit())},null,8,["aii"])]),_:1},8,["aii"])]),_:1})}}});typeof Q=="function"&&Q(Nt);export{Nt as default};
