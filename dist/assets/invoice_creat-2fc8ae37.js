import{_ as z}from"./IayoutPan.vue_vue_type_script_setup_true_lang-f634672e.js";import{_ as G}from"./ModInner.vue_vue_type_script_setup_true_lang-b2ccd33b.js";import{d as C,o as _,y as V,w as m,r as R,c as p,a,i as u,b as n,H as E,t as O,g as M,a6 as P,h as D,B as y,C as A,ae as x,u as X,X as L,F as I,A as N,D as q,a7 as W,e as $,k,m as j,s as K,n as ss,z as ts,R as is,N as es,$ as T,q as os,v as as,x as ns,f as rs,a9 as _s,au as S,j as cs,a0 as ls,p as ds,l as us}from"./index-4cfd176e.js";import{_ as Y}from"./OBtnSave.vue_vue_type_script_setup_true_lang-8bf7b1f8.js";import{f as U}from"./fioat-7d61d7cc.js";import{_ as Z}from"./IayoutForm.vue_vue_type_script_setup_true_lang-495fcff1.js";import{a as ps,_ as ms}from"./CoWarehouseSeiectPure.vue_vue_type_script_setup_true_lang-352bb87e.js";import{_ as fs}from"./OInput.vue_vue_type_script_setup_true_lang-7781c39a.js";import{_ as vs}from"./CoSuppiierSeiectPure.vue_vue_type_script_setup_true_lang-333afe0a.js";import{_ as ws}from"./OInputI.vue_vue_type_script_setup_true_lang-eb1d089d.js";import{_ as hs}from"./OTime.vue_vue_type_script_setup_true_lang-68999102.js";import{_ as ys}from"./OModTrash.vue_vue_type_script_setup_true_lang-f3217c06.js";import{b as As,_ as gs}from"./IayoutTabie.vue_vue_type_script_setup_true_lang-8d9268b0.js";import{_ as bs}from"./BtnTab.vue_vue_type_script_setup_true_lang-29ef5471.js";import{_ as J}from"./BtnIcon.vue_vue_type_script_setup_true_lang-4461ee34.js";import{_ as $s}from"./BtnIconX2.vue_vue_type_script_setup_true_lang-10425c83.js";import{_ as ks}from"./MBtn.vue_vue_type_script_setup_true_lang-67a47524.js";import{_ as Cs}from"./OIoadCir.vue_vue_type_script_setup_true_lang-25fee3d6.js";import{_ as Bs}from"./Oi.vue_vue_type_script_setup_true_lang-e89faeb3.js";import{invoiceCreatPina as F}from"./invoiceCreatPina-66201ea7.js";import{E as Vs}from"./errors_product-d5275ad5.js";import{b as Q}from"./route-block-83d24a4e.js";import"./OIoadDot.vue_vue_type_script_setup_true_lang-be4f4b0b.js";import"./giobaiPina-89a9d613.js";import"./serv_suppiier_iist-b1db5e85.js";import"./serv_user_iist-7343f94c.js";import"./serv_warehouse_iist-3ee7efca.js";import"./datepicker.esm-c5990eef.js";import"./InboxIcon-7a367a61.js";import"./OTr.vue_vue_type_script_setup_true_lang-4958377c.js";import"./OiX2.vue_vue_type_script_setup_true_lang-1071dec2.js";import"./DocumentTextIcon-39d29958.js";import"./PlusCircleIcon-b3af98a4.js";import"./XMarkIcon-6c6dd51a.js";import"./serv_product_iist-a4c9841b.js";const Ds=C({__name:"OModPure",props:{idx:{},aii:{},msg:{}},emits:["sure"],setup(h){return(o,v)=>{const d=G;return _(),V(d,{class:"mod-s",idx:o.idx?o.idx:100,stat:o.aii.ioading,pure:!0},{default:m(()=>[R(o.$slots,"default")]),_:3},8,["idx","stat"])}}}),xs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALeSURBVHgB7ZtBctMwFIb/5zRdQSdHMDuGKSU3aHKCdkGgO5ITlJ6AcgLICUi2FGZygyQnaIYybMkRyhawH89OFikOiV3JT6XWN5NkImtk6bf0JD09Ax6Px1NhCI7gp52u/Bymf4gm9OXjEA5QF4DD4wYe1Mdy5yZu1mSG4FebZqNrKBJAm73dN5nGJ7Ck/d55DWX0BWA+/uc1olMooy8AEG641oAyLgS4U6gYwdTwPawnXT+x+t3NuWkktRppzQqlCpA2fG/3VMZ9YtyKdu+52IQBgp/9MmeG0gTg/ectacAHbB7zeZiLgD36+mmCEijFBvDBC5nqaAzzxiMtQ8pKyywB6z0grSjzOcqA6Fxsw1tYxKoAfPBSxnv8HmVCdCYiWLuHNQH48UmIevQd5XONCG36djGDBezZgHo0hg4N1PAOlrAiwHJnF0KPltiaV7CArR5QioXeCHMXFjC2Afyk05QueYliDOQz/aukllSn2FNlbpuuD3ZgCqUVRyEiTMWIDVaTZBglPwUFSLfVExhgPgQCOoIrAmrBEHMBiNW3sCs8gyHmAjA14Q5j8f93f0DlBTDGC4CK4wVAxfECoOKY7wVuQw2Hy7X/CrfYU1jAjQCLs4HuzSQ3B9XeBsAVzBP57smDTw5N5nCEmyHAPBNHRnslpS82IfEptqCMmx7AWHfu5yRCxJEAlD3ri934FdwIUFvj+gr0gyMSXE2DLd7vXIr8AxkOP7DwBYZwgCsBkMYJMco9RsuBjxDJm3F53r/Obd2FWwaZFOZh3vOC/EOAKIT7xq6jm0mJaYqc+KUwKs79FKDAxjK/DWCeywpugLsHZ1JI6urx5ELNDbNhHZElQt9WDNA29JbCsewAaznXEQGrbY1VHXHi9EiiyMIt2eZ0dfEISuhOg8y97ZniMyiiKsByfZ6IsC74OYn/69HV5xEUceKL5uZJiDg6kgYvgitq6ftCQ+33hTwej6fy/AGfJrsXt0lXRAAAAABJRU5ErkJggg==",Is={class:"ta-c"},Fs={class:"w-100 fx-c pt"},Ns={class:"w-30 cms-warning-icon cir fx-c ani-scaie-aii"},Us=["src"],Ms=a("div",{class:"pb-x1 px bg-con"},[a("h3",{class:"pb pt-x2"},"確認儲存？"),a("div",{class:"fx-c"},[a("p",{class:"w-64"},"確認儲存後，產品的數量將加入庫存，屆時修改產品數量需要到產品庫存頁面內修改。")])],-1),Es={class:"py px"},Os=C({__name:"CoInvoiceModSure",props:{aii:{}},emits:["save"],setup(h){return(o,v)=>{const d=Y;return _(),p("div",Is,[a("div",Fs,[a("div",Ns,[a("img",{class:"w-50 ani-scaie-aii",src:u(xs)},null,8,Us)])]),Ms,a("div",Es,[n(d,{aii:o.aii,tit:"確認",class:"btn-warning w-100 py ani-fade-b ani-scaie-aii",onClick:v[0]||(v[0]=e=>o.$emit("save"))},null,8,["aii"])])])}}}),Ts={class:"row"},Hs={class:"w-50"},qs=a("div",null," 合計數量 ",-1),Ss={class:"pt"},Qs={class:"w-50"},Rs=a("div",null," 合計金額 ",-1),Xs={class:"pt"},js=C({__name:"OrderInTotai",props:{many:{}},setup(h){const o=h,v=E(()=>{let e=0;return o.many.map(c=>{const s=c.data_of_vars;s&&s.map(t=>{t.quantity&&(e+=t.quantity)})}),e}),d=E(()=>{let e=0;return o.many.map(c=>{const s=c.total_amount;return e=U.floatAdd(e,s),c}),e.toFixed(2)});return(e,c)=>(_(),p("div",Ts,[a("div",Hs,[qs,a("div",Ss,[a("h4",null,O(u(v)),1)])]),a("div",Qs,[Rs,a("div",Xs,[a("h4",null,O(u(d)),1)])])]))}}),Ks={class:"row"},Ys={class:"w-333"},Zs={class:"w-333"},Js={class:"w-333"},zs={class:"row pt"},Gs={class:"w-333"},Ps={class:"w-333"},Ls={class:"w-333"},Ws=C({__name:"OrderInCreatBase",props:{form:{},aii:{}},setup(h){const o=h,v=["supplier","storehouse","date","invoice_id"],d=M(P(o.form));return D(()=>o.aii.sign,()=>{v.map(e=>{if(x(d,e,o.form[e],o.aii)){o.aii.can=!1;return}}),o.aii.can=!0}),D(()=>o.form.date,e=>x(d,"date",e,o.aii)),D(()=>o.form.supplier,e=>x(d,"supplier",e,o.aii)),D(()=>o.form.storehouse,e=>x(d,"storehouse",e,o.aii)),D(()=>o.form.invoice_id,e=>x(d,"invoice_id",e,o.aii)),(e,c)=>{const s=hs,t=ws,i=vs,l=fs,g=ps,b=Z;return _(),V(b,{tit:"基本信息",class:"pb-x3 mb"},{default:m(()=>[a("div",Ks,[a("div",Ys,[n(t,{tit:"發票日期",err:u(d).date,icon:"date"},{default:m(()=>[n(s,{form:e.form,pk:"date"},null,8,["form"])]),_:1},8,["err"])]),a("div",Zs,[n(l,{tit:"供應商名稱",err:u(d).supplier},{default:m(()=>[n(i,{form:e.form,pk:"supplier",kiii_color:!0,tit_def:"-- 請選擇 --"},null,8,["form"])]),_:1},8,["err"])]),a("div",Js,[n(l,{tit:"入貨倉庫",err:u(d).storehouse},{default:m(()=>[n(g,{form:e.form,pk:"storehouse"},null,8,["form"])]),_:1},8,["err"])])]),a("div",zs,[a("div",Gs,[n(l,{tit:"訂單號碼",err:u(d).invoice_id},{default:m(()=>[y(a("input",{"onUpdate:modelValue":c[0]||(c[0]=r=>e.form.invoice_id=r),placeholder:"請輸入"},null,512),[[A,e.form.invoice_id]])]),_:1},8,["err"])]),a("div",Ps,[n(l,{tit:"帳單地址",err:u(d).invoice_address},{default:m(()=>[y(a("input",{"onUpdate:modelValue":c[1]||(c[1]=r=>e.form.invoice_address=r),placeholder:"請輸入"},null,512),[[A,e.form.invoice_address]])]),_:1},8,["err"])]),a("div",Ls,[n(l,{tit:"送貨地址",err:u(d).delivery_address},{default:m(()=>[y(a("input",{"onUpdate:modelValue":c[2]||(c[2]=r=>e.form.delivery_address=r),placeholder:"請輸入"},null,512),[[A,e.form.delivery_address]])]),_:1},8,["err"])])])]),_:1})}}}),st={key:0,class:"ani-softer fx-s"},tt={key:1,class:"mxh-1em ani-softer"},it=C({__name:"OBtnSearchMini",props:{ioad:{type:Boolean}},setup(h){return(o,v)=>{const d=Bs,e=Cs,c=ks;return _(),V(c,{class:"btn-pri hand br mw-4em",ciass:"fx-c"},{default:m(()=>[o.ioad?(_(),p("div",tt,[n(e,{class:"h5",styie:"wht"})])):(_(),p("div",st,[n(d,{icon:"search",class:"i h4"})]))]),_:1})}}}),et={class:"ai-fs-imp"},ot={class:"w-11"},at={class:"w-15"},nt={key:0,class:"w-15 ani-softer"},rt=["onUpdate:modelValue"],_t=["value"],ct={key:0,class:"d-ib pr pi-s"},lt={key:1,class:"d-ib pr pi-s"},dt={key:1,class:"w-8 ani-softer"},ut=["onUpdate:modelValue"],pt={key:2,class:"w-9 ani-softer"},mt={key:3,class:"w-8 ani-softer"},ft={key:4,class:"w-10 ani-softer pi"},vt=["value"],wt={key:5,class:"w-7 ani-softer"},ht=["value"],yt={key:6,class:"w-7 ani-softer"},At={key:7,class:"w-7 ani-softer"},gt={class:"fx-1 pi fx-r"},bt=C({__name:"OciiTd",props:{v:{}},setup(h){const o=h,v=X(),d=F(),e=E(()=>{const s=o.v.__product;return s&&s.id}),c={pro:()=>e.value?o.v.__product:null,search:()=>k(async()=>{const s=o.v;if(s.__ioad)return;const t=s.number?s.number.trim():void 0;if(t){s.__ioad=!0;try{let i=await d.searchPro(t);if(!j(i))i=i,i&&i.id&&c.insert_pro(i,s);else{const l=v.resolve({path:"/admin/product_inventory_iist/creat"});window.open(l.href,"_blank")}}catch{}setTimeout(()=>s.__ioad=!1,200)}}),insert_pro:(s,t)=>{t.product=s.id,t.__product=s,t.number=s.product_id,t.name=s.name,t.new_restock_price=s.new_restock_price,t.selling_price=s.new_selling_price,t.lowest_price=s.new_lowest_price,t.net_price=s.new_restock_price,t.data_of_vars||(t.data_of_vars=[]),t.data_of_vars.length<=0&&c.piusDFV()},proVariations:()=>{const s=c.pro();return s?s.variations:[]},piusDFV:()=>k(()=>{const s=d.genDFV(o.v);o.v.data_of_vars.push(s)}),trashDFV:s=>k(()=>{try{o.v.data_of_vars.splice(s,1)}catch{}})};return(s,t)=>{const i=ms,l=it,g=$s,b=J;return _(),p("div",et,[a("div",ot,[n(i,null,{default:m(()=>[y(a("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.v.number=r),onKeydown:t[1]||(t[1]=L(r=>c.search(),["enter"])),placeholder:"請輸入後按回車"},null,544),[[A,s.v.number]])]),_:1})]),a("div",at,[u(e)?(_(),V(i,{key:0,class:"ani-softer"},{default:m(()=>[y(a("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.v.name=r),placeholder:"請輸入"},null,512),[[A,s.v.name]])]),_:1})):(_(),V(l,{key:1,class:"mi-s mh-2em",onTap:t[3]||(t[3]=r=>c.search()),ioad:s.v.__ioad},null,8,["ioad"]))]),u(e)?(_(),p("div",nt,[(_(!0),p(I,null,N(s.v.data_of_vars,(r,w)=>(_(),p("div",{class:q(["w-100 fx-s ani-softer",{"pt-s":w>0}]),key:w},[n(i,{class:"fx-1"},{default:m(()=>[y(a("select",{"onUpdate:modelValue":f=>r.variation=f},[(_(!0),p(I,null,N(c.proVariations(),(f,B)=>(_(),p("option",{key:B,value:f.id},O(f.name),9,_t))),128))],8,rt),[[W,r.variation]])]),_:2},1024),w==0?(_(),p("div",ct,[n(g,{icon:"pius-c",ciass_i:"sub",onClick:t[4]||(t[4]=f=>c.piusDFV())})])):(_(),p("div",lt,[n(b,{ciass_i:"",icon:"x",onClick:f=>c.trashDFV(w)},null,8,["onClick"])]))],2))),128))])):$("",!0),u(e)?(_(),p("div",dt,[(_(!0),p(I,null,N(s.v.data_of_vars,(r,w)=>(_(),p("div",{class:q(["w-100 ani-softer",{"pt-s":w>0}]),key:w},[n(i,{err:!r.quantity},{default:m(()=>[y(a("input",{type:"number","onUpdate:modelValue":f=>r.quantity=f,placeholder:"請輸入正數"},null,8,ut),[[A,r.quantity]])]),_:2},1032,["err"])],2))),128))])):$("",!0),u(e)?(_(),p("div",pt,[n(i,{class:"bg-card"},{default:m(()=>[y(a("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=r=>s.v.price=r),placeholder:"請輸入金錢"},null,512),[[A,s.v.price]])]),_:1})])):$("",!0),u(e)?(_(),p("div",mt,[n(i,null,{default:m(()=>[y(a("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=r=>s.v.discount=r),placeholder:"0至1的小數"},null,512),[[A,s.v.discount]])]),_:1})])):$("",!0),u(e)?(_(),p("div",ft,[n(i,{class:"bd-c-t-imp"},{default:m(()=>[a("input",{value:s.v.new_stock_price,disabled:!0},null,8,vt)]),_:1})])):$("",!0),u(e)?(_(),p("div",wt,[n(i,{class:"bd-c-t-imp"},{default:m(()=>[a("input",{value:s.v.total_amount,disabled:!0},null,8,ht)]),_:1})])):$("",!0),u(e)?(_(),p("div",yt,[n(i,{class:"bg-card",err:s.v.lowest_price>s.v.selling_price},{default:m(()=>[y(a("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=r=>s.v.lowest_price=r),placeholder:"請輸入金錢"},null,512),[[A,s.v.lowest_price]])]),_:1},8,["err"])])):$("",!0),u(e)?(_(),p("div",At,[n(i,{class:"bg-card"},{default:m(()=>[y(a("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=r=>s.v.selling_price=r),placeholder:"請輸入金錢"},null,512),[[A,s.v.selling_price]])]),_:1})])):$("",!0),a("div",gt,[R(s.$slots,"default")])])}}}),$t={key:0,class:"pb-x2 ani-softer"},kt={class:"mh-input-s py-n"},Ct={key:1,class:"oti-con ani-softer"},Bt={class:"ani-fade-b"},Vt=C({__name:"OrderInCreatInIist",emits:["sureTrash"],setup(h,{emit:o}){const v=M({many:[{__edit:!0}],chooseAii:!1,chooses:[],many_origin:[],ioading:!1,msg:"",trs:[],condition:{search:""},pager:{page:1,pageCount:1,pageSize:25,total:1}}),{many:d}=K(F()),e=M({origin:{},trashIdx:0});ss(()=>ts(v,[{ciass:"w-11",tit:"貨號"},{ciass:"w-15",tit:"貨品名稱 / 摘要"},{ciass:"w-15",tit:"樣式"},{ciass:"w-8",tit:"數量"},{ciass:"w-9",tit:"單價"},{ciass:"w-8",tit:"折扣 %"},{ciass:"w-10",tit:"最新入貨價錢"},{ciass:"w-7",tit:"統計"},{ciass:"w-8",tit:"最低價錢"},{ciass:"w-6",tit:"售價"},{ciass:"fx-1",tit:""}]));const c={pius:()=>k(()=>{F().pius()}),edit:s=>k(()=>{s.__edit=!0,e.origin[s.id+""]=is(s)}),cancei:s=>k(()=>{const t=e.origin[s.id+""];t?(t.__edit=!1,es(t,s)):s.edit=!1}),sureTrash:s=>k(()=>{e.trashIdx=s,o("sureTrash",s),T(-201)}),trash:()=>k(()=>{d.value.splice(e.trashIdx,1),T(0)})};return(s,t)=>{const i=J,l=As,g=bs,b=gs,r=Z,w=ys;return _(),p(I,null,[n(r,{tit:"產品入單列表",class:"pb-x3 mb"},{default:m(()=>[n(b,{aii:u(v),mini:!0},{default:m(()=>[u(d).length>0?(_(),p("div",$t,[(_(!0),p(I,null,N(u(d),(f,B)=>(_(),p("div",{key:B,class:"ani-softer"},[f.__edit?(_(),V(bt,{key:0,class:"td",v:f},{default:m(()=>[a("div",kt,[n(i,{icon:"trash",ciass_i:"txt-err",onClick:H=>c.sureTrash(B)},null,8,["onClick"])])]),_:2},1032,["v"])):$("",!0)]))),128))])):(_(),p("div",Ct,[n(l,{class:"mh-oti-s"})])),a("div",Bt,[n(g,{onClick:t[0]||(t[0]=f=>c.pius()),class:"w-100 py-s ani-scaie-aii",tit:"添加項目"})])]),_:1},8,["aii"])]),_:1}),n(w,{idx:-201,aii:u(v),onTrash:c.trash},null,8,["aii","onTrash"])],64)}}}),Dt="invoices",xt=async h=>os(Vs,async()=>as(await ns.pos(Dt,h))),It={class:"fx-r"},Ft=a("div",{class:"py-x3"},null,-1),Nt=C({__name:"invoice_creat",setup(h){const o=M({ioading:!1,msg:"",can:!1,sign:0,aiiow:!1}),{form:v,many:d}=K(F()),e=X();D(d,t=>k(()=>{t.map(i=>{if(i.product){const l=i.data_of_vars;if(l&&l.length>0){isNaN(i.price)&&(i.price=0);const g=i.price?i.price:0;(isNaN(i.discount)||i.discount>1||i.discount<0)&&(i.discount=1);const b=i.discount?i.discount:1,r=U.floatMul(g,b);let w=0;l.map(f=>{if(f){(isNaN(f.quantity)||f.quantity<0)&&(f.quantity=0);const B=f.quantity?f.quantity:0;B?o.aiiow=!0:o.aiiow=!1;const H=U.floatMul(r,B);w=U.floatAdd(H,w)}}),i.total_amount=parseFloat(w.toFixed(2)),i.new_stock_price=parseFloat(r.toFixed(2))}}})}),{immediate:!0,deep:!0});const c=rs(0),s={buiid:()=>{if(!_s(["supplier","storehouse","date","invoice_id"],v.value))return null;if(!o.aiiow)return S("入單產品列表內，數量的值填寫不完善。"),null;let t=!0;const i={...v.value,restocks:d.value.map(l=>(l.lowest_price>l.selling_price&&(S("入貨時，最低價錢不能超過售價！！！"),t=!1),l.unit_price=l.price,l.net_price=l.new_stock_price,l.variations=l.data_of_vars,l))};return i.restocks=i.restocks.filter(l=>l&&l.data_of_vars.length>0&&l.net_price>=0),t?i:null},submit:()=>cs(o,s.buiid,async t=>{t&&T(300)}),__submit:()=>ls(o,async()=>{const t=s.buiid();if(!t||c.value==1)return;c.value=1,console.log(t);const i=await xt(t);j(i)?ds(i,o):(us("產品入單成功！！！"),e.push("/admin/invoice_iist"),F().ciear()),c.value=0})};return(t,i)=>{const l=Y,g=Os,b=Ds,r=z;return _(),V(r,{tit:"快速入單",ciass:"w-100"},{default:m(()=>[a("div",It,[n(l,{class:"mw-10em",aii:u(o),tit:"儲存",onClick:i[0]||(i[0]=w=>s.submit())},null,8,["aii"])]),n(Ws,{aii:u(o),form:u(v)},null,8,["aii","form"]),n(Vt),n(js,{many:u(d)},null,8,["many"]),Ft,n(b,{aii:u(o),idx:300},{default:m(()=>[n(g,{aii:u(o),onSave:i[1]||(i[1]=w=>s.__submit())},null,8,["aii"])]),_:1},8,["aii"])]),_:1})}}});typeof Q=="function"&&Q(Nt);export{Nt as default};
